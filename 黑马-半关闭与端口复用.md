# 半关闭与端口复用

1. **半关闭**：TCP连接后A向B发送FIN请求关闭且B端回应ACK之后，B没有立刻发送FIN给A，此时A**结束自己的发送但可以接收来自B端的数据**，这样的状态称为半关闭，使用<u>shutdown函数</u>来实现。    
2. **shutdown**函数与**close**的区别：
   1. 若有多个文件描述符同时指向一个socket套接字，那么close其中一个后，该套接字还可以被其它文件描述符读写；shutdown会直接关闭所有指向该套接字的文件描述符。
   2. shutdown可以指定是读方式关(SHUT_RD(0))还是写方式关(SHUT_WR(1))，还是关闭读写功能(SHUT_RDWR(2))。
   3. 有多个进程共享一个套接字时，close每被调用一次，计数减一，计数为0套接字被释放。
   4. 若多进程中有一个进程调用了shutdown，其他进程将无法通信；但如果一个进程close不影响其他进程。
3. **端口复用**：当服务器重启时，经常会碰到端口还没完全关闭的状态，因此需要设置端口复用，允许创建**端口号相同**但**IP地址不同**的多个socket描述符。使用**setsockopt**函数。